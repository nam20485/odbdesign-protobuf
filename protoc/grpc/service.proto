syntax = "proto3";
package Odb.Grpc;

// Import existing data models defined in OdbDesignLib
import "design.proto";
import "featuresfile.proto";
//import "common.proto";

// Service definition for ODB++ data
service OdbDesignService { 
  // Unary call to get the full design (similar to existing REST endpoint)
  // Used for initial load by a client.
  rpc GetDesign(GetDesignRequest) returns (.Odb.Lib.Protobuf.ProductModel.Design); 

  // Server-streaming call for high-performance streaming of layer features.
  // This is the primary performance-critical endpoint.
  rpc GetLayerFeaturesStream(GetLayerFeaturesRequest) returns (stream .Odb.Lib.Protobuf.FeaturesFile.FeatureRecord); 

  // A simple health check for the gRPC server
  rpc HealthCheck(HealthCheckRequest) returns (HealthCheckResponse);
}

// === Request/Response Messages ===
message GetDesignRequest { 
  string design_name = 1;
}

message GetLayerFeaturesRequest { 
  string design_name = 1;
  string step_name = 2; 
  string layer_name = 3;
}

message HealthCheckRequest { 
  string service = 1;
}

message HealthCheckResponse { 
  enum ServingStatus { 
    UNKNOWN = 0;
    SERVING = 1; 
    NOT_SERVING = 2; 
  } 
  ServingStatus status = 1;
}